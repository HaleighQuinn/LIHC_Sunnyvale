knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
library(tigris)
library(leaflet)
library(censusapi)
library(dplyr)
# Census Key:
Sys.setenv(CENSUS_KEY="6e3cadd908fdaf8f7d3d728f4faa99e738db811a")
# Loading Contents of 1-year Data Dictionary
acs_vars_2019_1yr <-
listCensusMetadata(
name = "2019/acs/acs1",
type = "variables"
)
saveRDS(acs_vars_2019_1yr, "acs_vars_2019_1yr.rds")
View(acs_vars_2019_1yr)
sc_race <-
getCensus(
name = "acs/acs1",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:085",
vars = "group(B02001)"
) %>%
mutate(
cbg =
paste0(state,county,tract,block_group)
) %>%
select(!c(GEO_ID,state,county,tract,block_group,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_1yr %>%
select(name, label),
by = c("variable" = "name")
) %>%
select(-variable)
sc_race <-
getCensus(
name = "acs/acs1",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:085",
vars = "group(B02001)"
) %>%
mutate(
cbg =
paste0(state,county,tract,block_group)
) %>%
select(!c(GEO_ID,state,county,tract,block_group,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_1yr %>%
select(name, label),
by = c("variable" = "name")
) %>%
select(-variable)
sc_race <-
getCensus(
name = "acs/acs1",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:085",
vars = "group(B02001)"
) %>%
mutate(
cbg =
paste0(state,county,tract,block_group)
) %>%
select(!c(GEO_ID,state,county,tract,block_group,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_1yr %>%
select(name, label),
by = c("variable" = "name")
)
smc_sexbyage <-
getCensus(
name = "acs/acs1",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:081",
vars = "group(B01001)"
) %>%
mutate(
cbg =
paste0(state,county,tract,block_group)
) %>%
select(!c(GEO_ID,state,county,tract,block_group,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_1yr %>%
select(name, label),
by = c("variable" = "name")
) %>%
select(-variable) %>%
separate(
label,
into = c(NA,NA,"sex","age"),
sep = "!!"
) %>%
filter(!is.na(age))
acs_vars_2018_1yr <-
listCensusMetadata(
name = "2018/acs/acs1",
type = "variables"
)
saveRDS(acs_vars_2018_1yr, "acs_vars_2018_1yr.rds")
sc_race <-
getCensus(
name = "acs/acs1",
vintage = 2018,
region = "block group:*",
regionin = "state:06+county:085",
vars = "group(B02001)"
) %>%
mutate(
cbg =
paste0(state,county,tract,block_group)
) %>%
select(!c(GEO_ID,state,county,tract,block_group,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
) %>%
left_join(
acs_vars_2018_1yr %>%
select(name, label),
by = c("variable" = "name")
) %>%
select(-variable)%>%
separate(
label,
into = c(NA,NA,"sex","age"),
sep = "!!"
) %>%
filter(!is.na(age))
sc_race <-
getCensus(
name = "acs/acs1",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:085",
vars = "group(B02001)"
) %>%
mutate(
cbg =
paste0(state,county,tract,block_group)
) %>%
select(!c(GEO_ID,state,county,tract,block_group,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_1yr %>%
select(name, label),
by = c("variable" = "name")
)
sc_race <-
getCensus(
name = "acs/acs1",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:085",
vars = "group(B02001)"
) %>%
mutate(
cbg =
paste0(state,county,tract,block_group)
) %>%
select(!c(GEO_ID,state,county,tract,block_group,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_1yr %>%
select(name, label),
by = c("variable" = "name")
)
acs_vars_2019_5yr <-
listCensusMetadata(
name = "2019/acs/acs5",
type = "variables"
)
sc_sexbyage <-
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:085",
vars = "group(B01001)"
) %>%
mutate(
cbg =
paste0(state,county,tract,block_group)
) %>%
select(!c(GEO_ID,state,county,tract,block_group,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_5yr %>%
select(name, label),
by = c("variable" = "name")
) %>%
select(-variable) %>%
separate(
label,
into = c(NA,NA,"sex","age"),
sep = "!!"
) %>%
filter(!is.na(age))
View(sc_sexbyage)
sc_race <-
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:085",
vars = "group(B02001)"
) %>%
mutate(
cbg =
paste0(state,county,tract,block_group)
) %>%
select(!c(GEO_ID,state,county,tract,block_group,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_5yr %>%
select(name, label),
by = c("variable" = "name")
) %>%
select(-variable)%>%
separate(
label,
into = c(NA,NA,"sex","race"),
sep = "!!"
) %>%
filter(!is.na(race))
View(sc_race)
View(acs_vars_2019_5yr)
sc_sexbyagebydisab <-
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:085",
vars = "group(B01001)"
) %>%
mutate(
cbg =
paste0(state,county,tract,block_group)
) %>%
select(!c(GEO_ID,state,county,tract,block_group,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_5yr %>%
select(name, label),
by = c("variable" = "name")
) %>%
select(-variable) %>%
separate(
label,
into = c(NA,NA,NA,"sex","age", "disability"),
sep = "!!"
) %>%
filter(!is.na(disability))
sc_sexbyagebydisab <-
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:085",
vars = "group(B01001)"
) %>%
mutate(
cbg =
paste0(state,county,tract,block_group)
) %>%
select(!c(GEO_ID,state,county,tract,block_group,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_5yr %>%
select(name, label),
by = c("variable" = "name")
) %>%
select(-variable) %>%
separate(
label,
into = c(NA,NA,"sex","age"),
sep = "!!"
) %>%
filter(!is.na(age))
View(sc_sexbyagebydisab)
View(sc_sexbyagebydisab)
sc_youthdisab <-
smc_sexbyagebydisab %>%
mutate(
youth =
ifelse(
age %in% c(
"5 to 9 years",
"10 to 14 years",
"15 to 17 years",
"20 years",
"21 years",
"22 to 24 years",
"25 to 29 years"
),
estimate,
NA
)
) %>%
group_by(cbg) %>%
summarize(
youth = sum(youth, na.rm = T),
total_pop = sum(estimate, na.rm = T)
) %>%
mutate(
percent_youth = youth/total_pop*100
) %>%
filter(!is.na(percent_youth))
sc_youthdisab <-
sc_sexbyagebydisab %>%
mutate(
youth =
ifelse(
age %in% c(
"5 to 9 years",
"10 to 14 years",
"15 to 17 years",
"20 years",
"21 years",
"22 to 24 years",
"25 to 29 years"
),
estimate,
NA
)
) %>%
group_by(cbg) %>%
summarize(
youth = sum(youth, na.rm = T),
total_pop = sum(estimate, na.rm = T)
) %>%
mutate(
percent_youth = youth/total_pop*100
) %>%
filter(!is.na(percent_youth))
View(sc_youthdisab)
sc_blockgroups <- block_groups("CA", "Santa Clara", cb = T, progress_bar = F)
youth_pal <- colorNumeric(
palette = "Blues",
domain =
sc_youthdisab$percent_youth
)
leaflet() %>%
addTiles() %>%
addPolygons(
data =
sc_youthdisab %>%
left_join(
sc_blockgroups %>% select(GEOID),
by = c("cbg" = "GEOID")
) %>%
st_as_sf() %>%
st_transform(4326),
fillColor = ~youth_pal (percent_youth),
color = "white",
opacity = 0.5,
fillOpacity = 0.5,
weight = 1,
label = ~paste0(
round(percent_youth),
"% under 30 years old"
),
highlightOptions = highlightOptions(
weight = 2,
opacity = 1
)
) %>%
addLegend(
data = sc_youthdisab,
pal = youth_pal,
values = ~percent_youth,
title = "% of youth under 30 with disabilities"
)
