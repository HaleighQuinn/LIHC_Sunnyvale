select(name, label),
by = c("variable" = "name")
) %>%
select(-variable) %>%
separate(
label,
into = c(NA,NA,"income"),
sep = "!!"
) %>%
filter(!is.na(income)) %>%
mutate(race = census_race_labels[x])
})
rm(sc_sexbyagebydisab)
rm(sc_race)
rm(acs_vars_2018_1yr)
View(sc_income_race)
sc_income_race <-
1:7 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs5",
vintage = 2018,
region = "county:085",
regionin = "state:06",
vars = paste0("group(B19001",LETTERS[x],")")
) %>%
select(!c(GEO_ID,state,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_5yr %>%
select(name, label),
by = c("variable" = "name")
) %>%
select(-variable) %>%
separate(
label,
into = c(NA,NA,"income"),
sep = "!!"
) %>%
filter(!is.na(income)) %>%
mutate(race = census_race_labels[x])
})
sc_income_race <-
1:7 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs5",
vintage = 2018,
region = "county:085",
regionin = "state:06",
vars = paste0("group(B19001",LETTERS[x],")")
) %>%
mutate(
cbg =
paste0(state,county,tract,block_group)
) %>%
select(!c(GEO_ID,state,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_5yr %>%
select(name, label),
by = c("variable" = "name")
) %>%
select(-variable) %>%
separate(
label,
into = c(NA,NA,"income"),
sep = "!!"
) %>%
filter(!is.na(income)) %>%
mutate(race = census_race_labels[x])
})
sc_income_race <-
1:7 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs5",
vintage = 2018,
region = "county:085",
regionin = "state:06",
vars = paste0("group(B19001",LETTERS[x],")")
) %>%
mutate(
cbg =
paste0(state,county,block_group)
) %>%
select(!c(GEO_ID,state,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_5yr %>%
select(name, label),
by = c("variable" = "name")
) %>%
select(-variable) %>%
separate(
label,
into = c(NA,NA,"income"),
sep = "!!"
) %>%
filter(!is.na(income)) %>%
mutate(race = census_race_labels[x])
})
sc_income_race <-
1:7 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs5",
vintage = 2018,
region = "county:085",
regionin = "state:06",
vars = paste0("group(B19001",LETTERS[x],")")
)
mutate(
cbg =
paste0(state,county,block_group)
) %>%
select(!c(GEO_ID,state,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_5yr %>%
select(name, label),
by = c("variable" = "name")
) %>%
select(-variable) %>%
separate(
label,
into = c(NA,NA,"income"),
sep = "!!"
) %>%
filter(!is.na(income)) %>%
mutate(race = census_race_labels[x])
})
sc_income_race <-
1:7 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs5",
vintage = 2018,
region = "county:085",
regionin = "state:06",
vars = paste0("group(B19001",LETTERS[x],")")
)
sc_income_race <-
1:7 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs5",
vintage = 2018,
region = "block group:*",
regionin = "state:06+county:085",
vars = paste0("group(B19001",LETTERS[x],")")
)
mutate(
cbg =
paste0(state,county,block_group)
) %>%
select(!c(GEO_ID,state,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_5yr %>%
select(name, label),
by = c("variable" = "name")
) %>%
select(-variable) %>%
separate(
label,
into = c(NA,NA,"income"),
sep = "!!"
) %>%
filter(!is.na(income)) %>%
mutate(race = census_race_labels[x])
})
sc_income_race <-
1:7 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs5",
vintage = 2018,
region = "block group:*",
regionin = "state:06+county:085",
vars = paste0("group(B19001",LETTERS[x],")")
)
sc_income_race <-
1:7 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs5",
vintage = 2018,
region = "block group:*",
regionin = "state:06+county:085",
vars = paste0("group(B19001",LETTERS[x],")")
) %>%
select(!c(GEO_ID,state,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_5yr %>%
select(name, label),
by = c("variable" = "name")
) %>%
select(-variable) %>%
separate(
label,
into = c(NA,NA,"income"),
sep = "!!"
) %>%
filter(!is.na(income)) %>%
mutate(race = census_race_labels[x])
}) %>%
filter(county %in% neighborhood_cbgs$COUNTYFP)
sc_income_race <-
1:7 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:085",
vars = paste0("group(B19001",LETTERS[x],")")
) %>%
select(!c(GEO_ID,state,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_5yr %>%
select(name, label),
by = c("variable" = "name")
) %>%
select(-variable) %>%
separate(
label,
into = c(NA,NA,"income"),
sep = "!!"
) %>%
filter(!is.na(income)) %>%
mutate(race = census_race_labels[x])
}) %>%
filter(county %in% neighborhood_cbgs$COUNTYFP)
sc_income_race <-
1:7 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:085",
vars = paste0("group(B19001",LETTERS[x],")")
) %>%
select(!c(GEO_ID,state,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_5yr %>%
select(name, label),
by = c("variable" = "name")
) %>%
select(-variable) %>%
separate(
label,
into = c(NA,NA,"income"),
sep = "!!"
) %>%
filter(!is.na(income)) %>%
mutate(race = census_race_labels[x])
})
sc_income_race <-
1:7 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:085",
vars = paste0("group(B19001",LETTERS[x],")")
)
%>%
sc_income_race <-
1:7 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:085",
vars = paste0("group(B19001",LETTERS[x],")")
)
sc_income_race <-
1:7 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:085",
vars = paste0("group(B19001",LETTERS[x],")")
) %>%
select(!c(GEO_ID,state,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_5yr %>%
select(name, label),
by = c("variable" = "name")
) %>%
select(-variable) %>%
separate(
label,
into = c(NA,NA,"income"),
sep = "!!"
) %>%
filter(!is.na(income)) %>%
mutate(race = census_race_labels[x])
}) %>%
filter(county %in% neighborhood_cbgs$COUNTYFP)
sc_race_total <-
sc_income_race %>%
group_by(race) %>%
summarize(estimate = sum(estimate)) %>%
mutate(income = "Total")
sc_race_total <-
sc_income_race %>%
group_by(race) %>%
summarize(estimate = sum(estimate)) %>%
mutate(income = "Total")
sc_income_race %>%
group_by(income, race) %>%
summarize(estimate = sum(estimate)) %>%
rbind(sc_race_total) %>%
ggplot() +
geom_bar(
aes(
x = income %>% factor(levels = rev(c("Total",sc_income_race$income[1:16]))),
y = estimate,
fill = race
),
stat = "identity",
position = "fill"
) +
labs(
x = "Household income",
y = "Proportion of households",
title = "Bay Area household income by race",
fill = "Race of householder"
) +
coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
)
library(ggplot)
sc_race_total <-
sc_income_race %>%
group_by(race) %>%
summarize(estimate = sum(estimate)) %>%
mutate(income = "Total")
sc_income_race %>%
group_by(income, race) %>%
summarize(estimate = sum(estimate)) %>%
rbind(sc_race_total) %>%
ggplot() +
geom_bar(
aes(
x = income %>% factor(levels = rev(c("Total",sc_income_race$income[1:16]))),
y = estimate,
fill = race
),
stat = "identity",
position = "fill"
) +
labs(
x = "Household income",
y = "Proportion of households",
title = "Bay Area household income by race",
fill = "Race of householder"
) +
coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
)
library(plotly)
sc_race_total <-
sc_income_race %>%
group_by(race) %>%
summarize(estimate = sum(estimate)) %>%
mutate(income = "Total")
sc_income_race %>%
group_by(income, race) %>%
summarize(estimate = sum(estimate)) %>%
rbind(sc_race_total) %>%
ggplot() +
geom_bar(
aes(
x = income %>% factor(levels = rev(c("Total",sc_income_race$income[1:16]))),
y = estimate,
fill = race
),
stat = "identity",
position = "fill"
) +
labs(
x = "Household income",
y = "Proportion of households",
title = "Bay Area household income by race",
fill = "Race of householder"
) +
coord_flip() +
theme(
legend.position = "bottom",
legend.direction = "vertical"
)
sc_race_total <-
sc_income_race %>%
group_by(race) %>%
summarize(estimate = sum(estimate)) %>%
mutate(income = "Total")
sc_income_race <-
1:7 %>%
map_dfr(function(x){
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:085",
vars = paste0("group(B19001",LETTERS[x],")")
) %>%
select(!c(GEO_ID,state,NAME) & !ends_with(c("EA","MA","M"))) %>%
pivot_longer(
ends_with("E"),
names_to = "variable",
values_to = "estimate"
) %>%
left_join(
acs_vars_2019_5yr %>%
select(name, label),
by = c("variable" = "name")
) %>%
select(-variable) %>%
separate(
label,
into = c(NA,NA,"income"),
sep = "!!"
) %>%
filter(!is.na(income)) %>%
mutate(race = census_race_labels[x])
}) %>%
filter(county %in% neighborhood_cbgs$COUNTYFP)
sc_race_total <-
sc_income_race %>%
group_by(race) %>%
summarize(estimate = sum(estimate)) %>%
mutate(income = "Total")
sc_income_race %>%
group_by(income, race) %>%
summarize(estimate = sum(estimate)) %>%
ggplot() +
geom_bar(
aes(
x = income %>% factor(),
y = estimate,
fill = race
),
stat = "identity",
position = "stack"
) +
labs(
x = "Household income",
y = "Number of households",
title = "Bay Area household income by race",
fill = "Race of householder"
)
sc_fm_income <-
getCensus(
name = "acs/acs5",
vintage = 2019,
region = "block group:*",
regionin = "state:06+county:085",
vars = "group(B19119)"
)
View(acs_vars_2019_5yr)
